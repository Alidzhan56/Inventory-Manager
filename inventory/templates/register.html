<!DOCTYPE html>
<html lang="{{ g.lang or 'en' }}">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{{ _('Register Company Owner') }} · WarePulse</title>

  <!-- Bootstrap & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />

  <style>
    :root{
      --bg1:#0b1220;
      --bg2:#0f1a33;
      --text:#e5e7eb;
      --muted:#94a3b8;
      --card: rgba(2,6,23,.38);
      --border: rgba(148,163,184,.18);
      --ring: rgba(59,130,246,.35);
      --primary:#3b82f6;
      --primary2:#2563eb;
      --shadow: 0 24px 60px rgba(0,0,0,.45);
      --radius: 18px;
    }

    body{
      min-height:100vh;
      margin:0;
      color:var(--text);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      background:
        radial-gradient(900px 500px at 15% 20%, rgba(59,130,246,.26), transparent 60%),
        radial-gradient(900px 500px at 85% 70%, rgba(16,185,129,.18), transparent 60%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
    }

    body:before{
      content:"";
      position:fixed;
      inset:0;
      pointer-events:none;
      background-image:
        linear-gradient(to right, rgba(148,163,184,.06) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(148,163,184,.06) 1px, transparent 1px);
      background-size: 52px 52px;
      mask-image: radial-gradient(700px 460px at 50% 25%, black 42%, transparent 78%);
      opacity:.85;
    }

    .page{
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 28px 16px;
      position:relative;
    }

    .wrap{
      width: min(1040px, 100%);
      display:grid;
      grid-template-columns: 1.05fr 0.95fr;
      border:1px solid var(--border);
      border-radius: var(--radius);
      overflow:hidden;
      box-shadow: var(--shadow);
      background: rgba(15,23,42,.55);
      backdrop-filter: blur(10px);
      transform: translateY(10px);
      opacity:0;
      animation: enter .7s ease forwards;
    }

    @keyframes enter{ to{ transform:translateY(0); opacity:1; } }

    @media (max-width: 992px){
      .wrap{ grid-template-columns: 1fr; }
      .left{ display:none; }
    }

    .left{
      padding: 42px 44px;
      background:
        radial-gradient(900px 420px at 20% 20%, rgba(59,130,246,.35), transparent 60%),
        radial-gradient(800px 420px at 80% 75%, rgba(16,185,129,.22), transparent 55%),
        linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.01));
      border-right:1px solid var(--border);
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      margin-bottom: 26px;
    }
    .brand img{
      width:42px;height:42px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      object-fit:cover;
    }
    .brand .title{ font-weight: 800; letter-spacing:-0.02em; line-height:1.1; }
    .brand .sub{ color: rgba(229,231,235,.75); font-size:.92rem; }

    .headline{
      font-size: 2.05rem;
      font-weight: 850;
      letter-spacing:-0.03em;
      line-height:1.05;
      margin: 10px 0 14px;
    }
    .desc{
      color: rgba(229,231,235,.78);
      font-size: 1.02rem;
      max-width: 44ch;
    }

    .steps{
      margin-top: 22px;
      display:grid;
      gap:10px;
    }
    .step{
      display:flex;
      gap:12px;
      align-items:flex-start;
      padding: 12px 14px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(15,23,42,.35);
    }
    .step .num{
      width: 28px;
      height: 28px;
      border-radius: 999px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight: 800;
      background: rgba(59,130,246,.18);
      border: 1px solid rgba(59,130,246,.35);
      color: #cfe0ff;
      flex: 0 0 auto;
    }
    .step .t{ font-weight: 750; margin-bottom:2px; }
    .step .s{ color: rgba(229,231,235,.72); font-size:.92rem; }

    .right{
      padding: 38px 34px;
      background: linear-gradient(180deg, rgba(15,23,42,.65), rgba(2,6,23,.65));
    }

    .cardish{
      border:1px solid rgba(148,163,184,.18);
      border-radius: 18px;
      background: var(--card);
      padding: 22px;
    }

    .form-title{
      font-weight: 850;
      letter-spacing:-0.02em;
      font-size: 1.25rem;
      margin-bottom: 6px;
    }
    .form-sub{
      color: var(--muted);
      font-size: .95rem;
      margin-bottom: 18px;
    }

    .form-label{
      color: rgba(229,231,235,.85);
      font-weight: 650;
      font-size: .9rem;
    }

    .form-control{
      background: rgba(15,23,42,.55);
      border: 1px solid rgba(148,163,184,.22);
      color: var(--text);
      border-radius: 14px;
      padding: 12px 12px;
    }
    .form-control::placeholder{ color: rgba(148,163,184,.75); }
    .form-control:focus{
      background: rgba(15,23,42,.70);
      border-color: rgba(59,130,246,.55);
      box-shadow: 0 0 0 .25rem var(--ring);
      color: var(--text);
    }

    .input-group-text{
      background: transparent;
      border: 0;
      color: rgba(229,231,235,.85);
      cursor: pointer;
      padding-right: 10px;
    }

    .progress{
      height: 8px;
      border-radius: 999px;
      background: rgba(148,163,184,.18);
      overflow:hidden;
    }
    .progress-bar{
      border-radius: 999px;
      transition: width .2s ease;
    }

    .rules{
      display:grid;
      gap:6px;
      margin-top: 10px;
    }
    .rule{
      display:flex;
      align-items:center;
      gap:10px;
      font-size: .92rem;
      color: rgba(229,231,235,.75);
    }
    .rule i{ width: 18px; }
    .rule.ok{ color: rgba(167,243,208,.95); }
    .rule.bad{ color: rgba(253,164,175,.95); }

    .btn-success{
      background: linear-gradient(135deg, #22c55e, #16a34a);
      border: 0;
      border-radius: 14px;
      padding: 12px 14px;
      font-weight: 800;
      box-shadow: 0 12px 28px rgba(34,197,94,.22);
      transition: transform .12s ease, filter .12s ease;
    }
    .btn-success:hover{ filter: brightness(1.05); transform: translateY(-1px); }
    .btn-success:active{ transform: translateY(0); }

    .muted-link{
      color: rgba(229,231,235,.75);
      text-decoration:none;
      font-weight: 650;
    }
    .muted-link:hover{ color:#fff; text-decoration: underline; }

    .alert{
      border-radius: 14px;
      border: 0;
      box-shadow: 0 10px 20px rgba(0,0,0,.2);
    }
  </style>
</head>

<body>
  <div class="page">
    <div class="wrap">

      <!-- Лява част: кратко обяснение какво следва -->
      <aside class="left">
        <div class="brand">
          <img src="{{ url_for('static', filename='warepulse-logo.png') }}" alt="WarePulse" />
          <div>
            <div class="title">WarePulse</div>
            <div class="sub">{{ _('Create your company workspace') }}</div>
          </div>
        </div>

        <div class="headline">{{ _('Set up your inventory system in minutes.') }}</div>
        <div class="desc">
          {{ _('You’re creating an Admin/Owner account. After login you can add warehouses, products, and team users.') }}
        </div>

        <div class="steps">
          <div class="step">
            <div class="num">1</div>
            <div>
              <div class="t">{{ _('Create owner account') }}</div>
              <div class="s">{{ _('This will be the main account for your company.') }}</div>
            </div>
          </div>
          <div class="step">
            <div class="num">2</div>
            <div>
              <div class="t">{{ _('Configure settings') }}</div>
              <div class="s">{{ _('Company name, currency, language, thresholds.') }}</div>
            </div>
          </div>
          <div class="step">
            <div class="num">3</div>
            <div>
              <div class="t">{{ _('Invite your team') }}</div>
              <div class="s">{{ _('Warehouse Manager & Sales Agent roles.') }}</div>
            </div>
          </div>
        </div>
      </aside>

      <!-- Дясна част: регистрационна форма -->
      <section class="right">
        <div class="cardish">
          <div class="form-title">
            <i class="bi bi-person-plus me-2"></i>{{ _('Register Company Owner') }}
          </div>
          <div class="form-sub">
            {{ _('Secure your account with a strong password.') }}
          </div>

          <!-- Флаш съобщения -->
          {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
              {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show mb-3" role="alert">
                  {{ message }}
                  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
              {% endfor %}
            {% endif %}
          {% endwith %}

          <form action="{{ url_for('auth.register_admin') }}" method="POST" novalidate>
            <div class="mb-3">
              <label class="form-label">{{ _('Email Address') }}</label>
              <input type="email" name="email" class="form-control" placeholder="name@company.com" required>
            </div>

            <div class="mb-3">
              <label class="form-label">{{ _('Username') }}</label>
              <input type="text" name="username" class="form-control" placeholder="john_doe" required minlength="3">
            </div>

            <div class="mb-3">
              <label class="form-label">{{ _('Password') }}</label>
              <div class="input-group align-items-center">
                <input type="password" id="password" name="password" class="form-control" placeholder="••••••••" required>
                <span class="input-group-text" id="togglePassword" title="{{ _('Show/Hide') }}">
                  <i class="bi bi-eye-slash" id="eyeIcon"></i>
                </span>
              </div>

              <!-- Правила за парола -->
              <div class="rules" id="passwordRules">
                <div class="rule bad" id="ruleLength"><i class="bi bi-x-circle"></i>{{ _('At least 8 characters') }}</div>
                <div class="rule bad" id="ruleUpper"><i class="bi bi-x-circle"></i>{{ _('At least one uppercase letter') }}</div>
                <div class="rule bad" id="ruleLower"><i class="bi bi-x-circle"></i>{{ _('At least one lowercase letter') }}</div>
                <div class="rule bad" id="ruleNumber"><i class="bi bi-x-circle"></i>{{ _('At least one number') }}</div>
                <div class="rule bad" id="ruleSymbol"><i class="bi bi-x-circle"></i>{{ _('At least one symbol') }}</div>
              </div>

              <!-- Индикатор за сила на парола -->
              <div class="progress mt-3">
                <div id="passwordStrength" class="progress-bar bg-danger" style="width: 0%"></div>
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label">{{ _('Confirm Password') }}</label>
              <div class="input-group align-items-center">
                <input type="password" id="confirm_password" name="confirm_password" class="form-control" placeholder="••••••••" required>
                <span class="input-group-text" id="toggleConfirm" title="{{ _('Show/Hide') }}">
                  <i class="bi bi-eye-slash" id="eyeConfirm"></i>
                </span>
              </div>
              <div id="confirmMessage" class="small mt-2"></div>
            </div>

            <div class="d-grid mt-4">
              <button id="submitBtn" type="submit" class="btn btn-success btn-lg" disabled>
                <i class="bi bi-shield-lock me-2"></i>{{ _('Create Owner Account') }}
              </button>
            </div>

            <div class="text-center mt-3">
              <small class="text-muted">
                {{ _('Already have an account?') }}
                <a class="muted-link" href="{{ url_for('auth.login') }}">{{ _('Login') }}</a>
              </small>
            </div>
          </form>
        </div>
      </section>

    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const password = document.getElementById('password');
      const confirm = document.getElementById('confirm_password');
      const confirmMsg = document.getElementById('confirmMessage');
      const submitBtn = document.getElementById('submitBtn');
      const strengthBar = document.getElementById('passwordStrength');

      const ruleMap = {
        length: document.getElementById('ruleLength'),
        upper: document.getElementById('ruleUpper'),
        lower: document.getElementById('ruleLower'),
        number: document.getElementById('ruleNumber'),
        symbol: document.getElementById('ruleSymbol')
      };

      function setRule(el, ok) {
        const icon = el.querySelector('i');
        el.classList.toggle('ok', ok);
        el.classList.toggle('bad', !ok);
        icon.className = ok ? 'bi bi-check2-circle' : 'bi bi-x-circle';
      }

      function validatePassword() {
        const val = password.value || '';
        const checks = {
          length: val.length >= 8,
          upper: /[A-Z]/.test(val),
          lower: /[a-z]/.test(val),
          number: /[0-9]/.test(val),
          symbol: /[^a-zA-Z0-9]/.test(val)
        };

        let score = 0;
        Object.keys(checks).forEach(k => {
          setRule(ruleMap[k], checks[k]);
          if (checks[k]) score++;
        });

        const pct = score * 20;
        strengthBar.style.width = pct + '%';

        strengthBar.classList.remove('bg-danger','bg-warning','bg-info','bg-primary','bg-success');
        if (score <= 1) strengthBar.classList.add('bg-danger');
        else if (score === 2) strengthBar.classList.add('bg-warning');
        else if (score === 3) strengthBar.classList.add('bg-info');
        else if (score === 4) strengthBar.classList.add('bg-primary');
        else strengthBar.classList.add('bg-success');

        return score === 5;
      }

      function validateConfirm() {
        if ((confirm.value || '').length === 0) {
          confirmMsg.textContent = '';
          confirmMsg.className = 'small mt-2';
          return false;
        }
        if (password.value === confirm.value) {
          confirmMsg.textContent = "{{ _('Passwords match!') }}";
          confirmMsg.className = "small mt-2 text-success";
          return true;
        } else {
          confirmMsg.textContent = "{{ _('Passwords do not match.') }}";
          confirmMsg.className = "small mt-2 text-danger";
          return false;
        }
      }

      function updateSubmit() {
        submitBtn.disabled = !(validatePassword() && validateConfirm());
      }

      // Показване/скриване на паролите
      document.getElementById('togglePassword').addEventListener('click', () => {
        password.type = password.type === 'password' ? 'text' : 'password';
        document.getElementById('eyeIcon').classList.toggle('bi-eye');
        document.getElementById('eyeIcon').classList.toggle('bi-eye-slash');
      });

      document.getElementById('toggleConfirm').addEventListener('click', () => {
        confirm.type = confirm.type === 'password' ? 'text' : 'password';
        document.getElementById('eyeConfirm').classList.toggle('bi-eye');
        document.getElementById('eyeConfirm').classList.toggle('bi-eye-slash');
      });

      // Валидация в реално време
      password.addEventListener('input', updateSubmit);
      confirm.addEventListener('input', updateSubmit);

      updateSubmit();
    });
  </script>
</body>
</html>
